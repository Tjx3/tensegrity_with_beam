clc,clear,close all
%% plot
L=[1.41421356237310
1.11803398874990
1.11803398874990
1.41421356237310
2
3
2
1.41421356237310
1.11803398874990
1.11803398874990
1.41421356237310];
C=[-1	1	0	0	0	0	0	0
0	-1	1	0	0	0	0	0
0	0	-1	1	0	0	0	0
0	0	0	-1	1	0	0	0
0	-1	0	0	0	0	0	1
0	0	-1	0	0	0	1	0
0	0	0	-1	0	1	0	0
-1	0	0	0	0	0	0	1
0	0	0	0	0	0	1	-1
0	0	0	0	0	1	-1	0
0	0	0	0	1	-1	0	0];
n=[0
0
0
1
-1
0
2
-1.50000000000000
0
3
-1
0
4
0
0
3
1
0
2
1.50000000000000
0
1
1
0];
F=[1.06066017177982
-0.0849422886974992
1.70895773297093e-16
-1.06066017177982
0.0849422886975004
-0.0849422886975007
0.686430427394681
0.169884577359644
0.0849422886975003
-0.686430427394682
-0.169884577359644
0.0849422886621435
0.686430427394681
-0.169884577359644
-0.0849422886621437
-0.686430427394680
0.169884577359644
-0.0849422886975002
1.06066017177982
0.0849422886975000
0.0849422886974999
-1.06066017177982
-0.0849422886975012
1.55048288198557e-15
0.344968365826245
2.32540558782420e-15
3.84920182973305e-16
-0.344968365826246
-1.27623168891000e-15
-4.53720783925910e-17
0.689936731652493
-2.14394627940638e-16
1.47298535647647e-16
-0.689936731652493
9.30348225975759e-16
-1.22795892882227e-15
0.344968365826245
-1.16132546030407e-15
3.21707873629909e-16
-0.344968365826244
6.26420234562309e-16
-5.07414711572091e-16
-0.975717883082320
2.94761926344749e-16
-1.08041055908046e-16
0.975717883082320
-1.92778435198980e-16
3.07076167705813e-16
-0.771372716074502
8.85267746364455e-16
6.96187075979707e-16
0.771372716074503
-3.44639365560267e-16
-4.21752253484727e-16
-0.771372716074502
3.90023966771977e-16
-2.72493459314592e-16
0.771372716074502
-1.02893693340509e-15
9.02649587591169e-16
-0.975717883082320
3.37313923763648e-16
3.82205619371169e-16
0.975717883082320
-9.05078786764358e-16
-3.80213523974158e-17];
N=[0 0 0;1 -1 0;2 -1.5 0;3 -1 0;4 0 0;3 1 0;2 1.5 0;1 1 0]';N=N';
C_b_in = [1 2;2 3;3 4;4 5;2 8;3 7;4 6;1 8;8 7;7 6;6 5]; 

mm=1;nn=4;
mmm=1;
F=F;
for i=1:11
    % 结构图
    for j=1:2
        var1(:,j)=C_b_in(i,j);
    end
    var2=var1(1);var3=var1(2);
    var4=N(var2,:);var5=N(var3,:);
    var6=var4(1);var7=var4(2);var8=var5(1);var9=var5(2);
    x=[var6,var8];y=[var7,var9];
    plot(x,y,'k','LineWidth',2)
    hold on
   % 轴力图
   % 坐标转换
    l_tem=L(i);    
    The_rod_element_direction_vector_tem=kron(C(i,:),eye(3))*n;
    dx=The_rod_element_direction_vector_tem(1);
    dy=The_rod_element_direction_vector_tem(2);
    cos=1/l_tem*dx;sin=1/l_tem*dy;
   % 横线
    xn1=F(mm)*sin+x(1);xn2=-F(nn)*sin+x(2);
    fn1=-F(mm)*cos+y(1);fn2=F(nn)*cos+y(2);
    mm=mm+6;nn=nn+6;
    xn=[xn1,xn2];
    fn=[fn1,fn2];
    plot(xn,fn,'r','LineWidth',2)
    hold on;
   % 边缘竖线
    xy_x=[x(1),xn(1)];xy_y=[y(1),fn(1)];
    plot(xy_x,xy_y,'r','LineWidth',2)
    hold on;
    yx_x=[x(2),xn(2)];yx_y=[y(2),fn(2)];
    plot(yx_x,yx_y,'r','LineWidth',2)
   % 已知两点求直线方程
   x=[var6,var8];y=[var7,var9];
   if x(1) ~= x(2)
       X=x(1):[x(2)-x(1)]/10:x(2);
       slope=(y(2)-y(1))/(x(2)-X(1));
       intercept=y(1)-slope*x(1);
       Y=slope*X+intercept;
       % plot(X,Y,'r','LineWidth',1)
       % hold on
   else
       X=[x(1),x(1),x(1),x(1),x(1),x(1),x(1),x(1),x(1),x(1),x(1)];
       Y=y(1):[y(2)-y(1)]/10:y(2);
       % plot(X,Y,'r','LineWidth',1)
       % hold on
   end
   % 中间竖线
   for i=2:length(X)-1
       xx=F(mmm)*sin+X(i);
       yy=-F(mmm)*cos+Y(i);

       xx_x=[X(i),xx];yy_y=[Y(i),yy];
       plot(xx_x,yy_y,'g','LineWidth',1)
       hold on;
   end
   % 标明轴力大小
   X_x=F(mmm)*sin+X(6);Y_y=-F(mmm)*cos+Y(6);
   str=mat2str(round(-F(mmm),4));
   text(X_x,Y_y,str,'Color','b','FontSize',8);
   mmm=mmm+6;
   
end
% Plot标识
xlabel({'L/m','轴力图'});ylabel('Fn/N');
title("张弦梁");
grid
1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %% 轴力图
% %F=T_diag'*w;
% 
% var=1;
% N=[0 0 0;1 -1 0;2 -1.5 0;3 -1 0;4 0 0;3 1 0;2 1.5 0;1 1 0]';N=N';
% C_b_in = [1 2;2 3;3 4;4 5;2 8;3 7;4 6;1 8;8 7;7 6;6 5]; 
% for i=1:11
%     for j=1:2
%         var1(:,j)=C_b_in(i,j);
%     end
%     var2=var1(1);var3=var1(2);
%     var4=N(var2,:);var5=N(var3,:);
%     var6=var4(1);var7=var4(2);var8=var5(1);var9=var5(2);
%     x=[var6,var8];y=[var7,var9];
%     %
%     fn=F(var);var=var+6;
%     %
%     plot(x,fn,'k','LineWidth',2)
%     hold on;
% end
% %%20241212